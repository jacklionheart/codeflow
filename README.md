# loopflow

A toolkit for collaborative code generation and exploration, combining structured LLM workflows with intelligent context management.

## Key Features

### `loopflow`: Structured Code Generation

loopflow breaks down the creation of files into a series of automated LLM interactions. 

loopflow:
- centralizes a structured prompt into a markdown file `loopflow.md`
- provides a sequence of commands (clarify, draft, review) that can be proceed from design to implementation in stages
- updates files in place and check points so that git diffs automatically show the changes generated by the llm
- creates named "mates": LLMs configured with different saved system prompts to specialize roles

The avaialable commands:
- **Clarify**: Each mate asks questions to clarify the requirements; these are grouped and sent as a single request to the user to answer
- **Draft**: Either the full team or a specific mate generates content:
  - *Team Mode*: Each mate generates a draft, reviews others' work, and one synthesizes the final result
  - *Single Mate Mode*: One mate directly drafts the file without review or synthesis
- **Review**: Each mate reviews current versions of the files

### Commands

```bash
# Initialize a new loopflow project
loopflow init [project_dir]

# Generate questions to clarify requirements
loopflow clarify [project_dir]

# Draft files (uses full team by default with a draft->review->synthesize subpipeline)
loopflow draft [project_dir] [--mate <mate_name>]

# Review existing files and append feedback
loopflow review [project_dir]

# Reset git history to before loopflow checkpoints
loopflow rebase [project_dir]
```

### Team Members

loopflow comes with two initial team members:
- maya: infrastructure engineer at a large tech company, focused on simplicity and robustness
- merlin: ML researcher specializing in novel architectures and mathematical abstractions

Adding more team members is TBD but coming.

### `code-context`: Smart Context Management

code-context is a spiritual descendent of [files-to-prompt](https://github.com/simonw/files-to-prompt), 
a tool for specifying and formatting a subset of a codebase to submit as context to an LLM.

code-context builds on files-to-prompt with additional features:
- Automatic detection and prioritization of parent READMEs
- Smart path resolution based on common codebase structures

## Installation

This is still very early in development. Contact jack@loopflow.studio with any questions.

Requires Python 3.11+
```bash
pip install -e .
```

You must set `ANTHROPIC_API_KEY` and/or `OPENAI_API_KEY` in your environment to use those providers.

## Usage

### Structured Code Generation

Create a prompt file defining your requirements:

```markdown
# Loopflow LLM Implementation

## Goal
Implement the LLM API for loopflow, a tool for generating code with teams of LLMs.

## Output
loopflow/llm/llm.py
loopflow/llm/anthropic.py
loopflow/tests/test_llm.py

## Context
loopflow/

## Team
maya
merlin
```

Run the workflow:
```bash
# Clarify requirements
loopflow clarify

# Draft with the full team (default)
loopflow draft

# Or draft with a specific mate
loopflow draft --mate maya
```

### Context Management

Copy specific paths to clipboard (OS X):
```bash
code-context -p myproject/src,myproject/tests
```

Filter to specific file types:
```bash
code-context -e .py -e .js myproject
```

Generate raw output:
```bash
code-context -r myproject
```

#### Path Resolution

The code-context tool uses smart defaults for finding files:

- Paths are relative to $CODE_CONTEXT_ROOT (default: ~/src)
- Direct paths are tried first: "myproj/env" -> "$CODE_CONTEXT_ROOT/myproj/env"
- Auto-prefixed paths are used as fallback: "myproj/env" -> "$CODE_CONTEXT_ROOT/myproj/myproj/env"
- Test directories are always at "myproj/tests"

## License

MIT